openapi: 3.0.2
info:
  title: 'RatingDB API'
  version: ''
  description: |
    Permissions are determined with respect to the following roles:\
    **Admin, Moderator, Authenticated, Author, Any**

security:
  - BasicAuth: []

paths:

  /titles:
    get:
      parameters:
      - name: category
        in: query
        description: 'Filter by slug of category'
        schema:
          type: string
      - name: genre
        in: query
        description: 'Filter by slug of genre'
        schema:
          type: string
      - name: name
        in: query
        description: 'Filter by partial contents of name'
        schema:
          type: string
      - name: year
        in: query
        description: 'Filter by year'
        schema:
          type: number
      tags:
        - Titles
      summary: Get all Titles
      description: >
        Permissions: **Any**
      responses:
        '200':
          description: List of titles returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: number
                    description: number of items
                  next:
                    type: string
                    description: link to the next page of items
                  previous:
                    type: string
                    description: link to the previous page of items
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/Title'
        'default':
          description: Unexpected error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      tags:
        - Titles
      summary: Add Title
      description: >
        Permissions: **Admin**, **Moderator**
      requestBody:
        description: Add title
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Title'
      responses:
        '201':
          description: Title added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Title'
        'default':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /titles/{title_id}:
    parameters:
      - name: title_id
        in: path
        required: true
        description: ''
        schema:
          type: number
    get:
      tags:
        - Titles
      summary: Get Title
      description: >
        Permissions: **Any**
      responses:
        '200':
          description: Title returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Title'
        '404':
          description: Title not found 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        'default':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      tags:
        - Titles
      summary: Replace Title
      requestBody:
        description: Replace Title
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Title'
      description: >
        Permissions: **Admin**, **Moderator**
      responses:
        '200':
          description: Title updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Title'
        '404':
          description: Title not found 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        'default':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      tags:
        - Titles
      summary: Partially update Title
      requestBody:
        description: Partially update Title
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Title'
      description: >
        Permissions: **Admin**, **Moderator**
      responses:
        '200':
          description: Title updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Title'
        '404':
          description: Title not found 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        'default':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags:
        - Titles
      summary: Delete Title
      description: >
        Permissions: **Admin**, **Moderator**
      responses:
        '204':
          description: Title deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Title'
        '404':
          description: Title not found 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        'default':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /genres:
    get:
      parameters:
      - name: search
        in: query
        description: 'Search by name of Genre'
        schema:
          type: string
      tags:
        - Genres
      summary: Get all Genres
      description: >
        Permissions: **Any**
      responses:
        '200':
          description: List of titles returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: number
                    description: number of items
                  next:
                    type: string
                    description: link to the next page of items
                  previous:
                    type: string
                    description: link to the previous page of items
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/Genre'
        'default':
          description: Unexpected error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      tags:
        - Genres
      summary: Add Genre
      description: >
        Permissions: **Admin**, **Moderator**
      requestBody:
        description: Add title
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Genre'
      responses:
        '201':
          description: Genre added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Genre'
        'default':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /genres/{genre_id}:
    parameters:
      - name: genre_id
        in: path
        required: true
        description: ''
        schema:
          type: number
    get:
      tags:
        - Genres
      summary: Get Genre
      description: >
        Permissions: **Any**
      responses:
        '200':
          description: Genre returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Genre'
        '404':
          description: Genre not found 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        'default':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      tags:
        - Genres
      summary: Replace Genre
      requestBody:
        description: Replace Genre
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Genre'
      description: >
        Permissions: **Admin**, **Moderator**
      responses:
        '200':
          description: Genre updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Genre'
        '404':
          description: Genre not found 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        'default':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      tags:
        - Genres
      summary: Partially update Genre
      requestBody:
        description: Partially update Genre
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Genre'
      description: >
        Permissions: **Admin**, **Moderator**
      responses:
        '200':
          description: Genre updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Genre'
        '404':
          description: Genre not found 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        'default':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags:
        - Genres
      summary: Delete Genre
      description: >
        Permissions: **Admin**, **Moderator**
      responses:
        '204':
          description: Genre deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Genre'
        '404':
          description: Genre not found 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        'default':
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    
components:
  schemas:
  
    Title:
      title: Title
      type: object
      description: Title
      required:
        - name
      properties:
        name:
          type: string
        year:
          type: number
        description:
          type: string
        genres:
          type: array
          description: list of applicable genres
          items:
            type: string
            description: slug of Genre
        category:
          type: string
          description: slug of Category

    Genre:
      title: Genre
      type: object
      description: Genre
      required:
        - name
        - slug
      properties:
        name:
          type: string
        slug:
          type: string
          description: unique slug of Genre

    Error:
      title: Error
      type: object
      description: Error details
      properties:
        error:
          type: string
          description: error details
  
  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
      